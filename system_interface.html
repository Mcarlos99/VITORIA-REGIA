<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Condom√≠nio Vit√≥ria R√©gia - Sistema de Gerenciamento</title>
    
    <!-- Meta tags de seguran√ßa -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Meta tags para PWA -->
    <meta name="theme-color" content="#2C5530">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Vit√≥ria R√©gia">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè°</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
        }

        /* Container principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .header {
            background: linear-gradient(135deg, #2C5530 0%, #4A7C59 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #2C5530;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .nav-tab.active {
            background: #2C5530;
            color: white;
            transform: translateY(-2px);
        }

        .nav-tab:hover {
            background: #4A7C59;
            color: white;
        }

        .content {
            padding: 30px;
            min-height: 500px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards e elementos */
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e3e6f0;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .card h3 {
            color: #2C5530;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.95em;
        }

        /* Grid de casas */
        .casas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .casa-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #2C5530;
            transition: all 0.3s ease;
        }

        .casa-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .casa-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .casa-numero {
            font-size: 1.5em;
            font-weight: 700;
            color: #2C5530;
        }

        .casa-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-ocupada {
            background: #d4edda;
            color: #155724;
        }

        .status-vazia {
            background: #f8d7da;
            color: #721c24;
        }

        .casa-info {
            margin-bottom: 15px;
        }

        .casa-info p {
            margin-bottom: 5px;
            color: #666;
        }

        .casa-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Formul√°rios e inputs */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2C5530;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #2C5530;
            box-shadow: 0 0 0 3px rgba(44, 85, 48, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Bot√µes */
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            line-height: 1.4;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2C5530, #4A7C59);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Tabelas */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2C5530;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        /* Modais */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-title {
            color: #2C5530;
            font-size: 1.3em;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #dc3545;
        }

        .modal-footer {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Alertas */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #28a745;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #17a2b8;
        }

        /* Upload de arquivos */
        .upload-area {
            border: 2px dashed #2C5530;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            background: #e9f7ef;
            border-color: #4A7C59;
        }

        .upload-area.dragover {
            background: #d4edda;
            border-color: #28a745;
        }

        .upload-icon {
            font-size: 3em;
            color: #2C5530;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #666;
            font-size: 16px;
        }

        .file-input {
            display: none;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
                margin: 0;
                min-height: 100vh;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 15px;
            }

            .user-info {
                position: static;
                display: inline-block;
                margin-bottom: 10px;
            }

            .logout-btn {
                position: static;
                display: inline-block;
                margin-left: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .casas-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                overflow-x: auto;
            }

            .modal-content {
                width: 95%;
                margin: 10px;
            }
        }

        /* Estados de conex√£o */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .connection-status.online {
            background: #28a745;
            color: white;
        }

        .connection-status.offline {
            background: #dc3545;
            color: white;
        }

        /* Anima√ß√µes customizadas */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading states */
        .loading {
            position: relative;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
        }

        .loading::before {
            content: 'üîÑ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            animation: spin 1s linear infinite;
            z-index: 1;
        }

        /* Elementos espec√≠ficos do sistema */
        .casa-ocupada {
            border-left-color: #28a745;
        }

        .casa-vazia {
            border-left-color: #dc3545;
        }

        .pagamento-pago {
            background: #d4edda;
        }

        .pagamento-pendente {
            background: #fff3cd;
        }

        .pagamento-atrasado {
            background: #f8d7da;
        }

        .observacao-pendente {
            border-left-color: #ffc107;
        }

        .observacao-resolvida {
            border-left-color: #28a745;
        }

        .observacao-em-andamento {
            border-left-color: #17a2b8;
        }
    </style>
</head>
<body>
    <!-- Tela de carregamento -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando sistema...</div>
    </div>

    <!-- Sistema principal -->
    <div id="main-system" style="display: none;">
        <div class="container">
            <button class="logout-btn" onclick="logout()">üö™ Sair</button>
            
            <div class="header">
                <div class="user-info">
                    üë§ <span id="user-name">Usu√°rio</span>
                </div>
                <h1>üè° Condom√≠nio Vit√≥ria R√©gia</h1>
                <p>Sistema de Gerenciamento - 8 Casas</p>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('casas')">üè† Casas</button>
                <button class="nav-tab" onclick="showTab('pagamentos')">üí∞ Pagamentos</button>
                <button class="nav-tab" onclick="showTab('observacoes')">üìù Observa√ß√µes</button>
                <button class="nav-tab" onclick="showTab('relatorios')">üìä Relat√≥rios</button>
            </div>

            <div class="content">
                <!-- Aba Casas -->
                <div id="tab-casas" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="total-casas">8</div>
                            <div class="stat-label">Total de Casas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="casas-ocupadas">0</div>
                            <div class="stat-label">Casas Ocupadas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="casas-vazias">8</div>
                            <div class="stat-label">Casas Vazias</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="taxa-ocupacao">0%</div>
                            <div class="stat-label">Taxa de Ocupa√ß√£o</div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>üè† Gerenciar Casas</h3>
                        <div class="casas-grid" id="casas-container">
                            <!-- Casas ser√£o carregadas aqui -->
                        </div>
                    </div>
                </div>

                <!-- Aba Pagamentos -->
                <div id="tab-pagamentos" class="tab-content">
                    <div class="card">
                        <h3>üí∞ Gerenciar Pagamentos</h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <label for="filtro-mes">M√™s:</label>
                                <select id="filtro-mes" class="form-control" style="width: auto; display: inline-block; margin: 0 10px;">
                                    <option value="">Todos</option>
                                    <option value="1">Janeiro</option>
                                    <option value="2">Fevereiro</option>
                                    <option value="3">Mar√ßo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Maio</option>
                                    <option value="6">Junho</option>
                                    <option value="7">Julho</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Setembro</option>
                                    <option value="10">Outubro</option>
                                    <option value="11">Novembro</option>
                                    <option value="12">Dezembro</option>
                                </select>
                                <label for="filtro-ano">Ano:</label>
                                <select id="filtro-ano" class="form-control" style="width: auto; display: inline-block; margin: 0 10px;">
                                    <option value="">Todos</option>
                                    <option value="2024">2024</option>
                                    <option value="2025" selected>2025</option>
                                    <option value="2026">2026</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="showAddPagamentoModal()">‚ûï Novo Pagamento</button>
                        </div>
                        <div id="pagamentos-container">
                            <!-- Pagamentos ser√£o carregados aqui -->
                        </div>
                    </div>
                </div>

                <!-- Aba Observa√ß√µes -->
                <div id="tab-observacoes" class="tab-content">
                    <div class="card">
                        <h3>üìù Gerenciar Observa√ß√µes</h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <label for="filtro-status-obs">Status:</label>
                                <select id="filtro-status-obs" class="form-control" style="width: auto; display: inline-block; margin: 0 10px;">
                                    <option value="">Todos</option>
                                    <option value="pendente">Pendente</option>
                                    <option value="em_andamento">Em Andamento</option>
                                    <option value="resolvida">Resolvida</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="showAddObservacaoModal()">‚ûï Nova Observa√ß√£o</button>
                        </div>
                        <div id="observacoes-container">
                            <!-- Observa√ß√µes ser√£o carregadas aqui -->
                        </div>
                    </div>
                </div>

                <!-- Aba Relat√≥rios -->
                <div id="tab-relatorios" class="tab-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="receita-mes">R$ 0</div>
                            <div class="stat-label">Receita do M√™s</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="pagamentos-pendentes">0</div>
                            <div class="stat-label">Pagamentos Pendentes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="observacoes-abertas">0</div>
                            <div class="stat-label">Observa√ß√µes Abertas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="taxa-recebimento">0%</div>
                            <div class="stat-label">Taxa de Recebimento</div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>üìä Relat√≥rios Detalhados</h3>
                        <div id="relatorios-container">
                            <!-- Relat√≥rios ser√£o carregados aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modais -->
    <!-- Modal Editar Casa -->
    <div id="editCasaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Editar Casa</h3>
                <button class="close-btn" onclick="closeModal('editCasaModal')">&times;</button>
            </div>
            <form id="editCasaForm">
                <input type="hidden" id="edit-casa-id">
                <div class="form-group">
                    <label class="form-label">Nome do Morador</label>
                    <input type="text" id="edit-morador" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Telefone</label>
                    <input type="tel" id="edit-telefone" class="form-control" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Contrato In√≠cio</label>
                        <input type="date" id="edit-contrato-inicio" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contrato Fim</label>
                        <input type="date" id="edit-contrato-fim" class="form-control" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Valor Mensal (R$)</label>
                    <input type="number" id="edit-valor-mensal" class="form-control" step="0.01" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editCasaModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Adicionar Pagamento -->
    <div id="addPagamentoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚ûï Novo Pagamento</h3>
                <button class="close-btn" onclick="closeModal('addPagamentoModal')">&times;</button>
            </div>
            <form id="addPagamentoForm">
                <div class="form-group">
                    <label class="form-label">Casa</label>
                    <select id="add-casa-id" class="form-control" required>
                        <option value="">Selecione uma casa</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">M√™s</label>
                        <select id="add-mes" class="form-control" required>
                            <option value="1">Janeiro</option>
                            <option value="2">Fevereiro</option>
                            <option value="3">Mar√ßo</option>
                            <option value="4">Abril</option>
                            <option value="5">Maio</option>
                            <option value="6" selected>Junho</option>
                            <option value="7">Julho</option>
                            <option value="8">Agosto</option>
                            <option value="9">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ano</label>
                        <select id="add-ano" class="form-control" required>
                            <option value="2024">2024</option>
                            <option value="2025" selected>2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Valor (R$)</label>
                    <input type="number" id="add-valor" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Data do Pagamento</label>
                    <input type="date" id="add-data-pagamento" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="add-status" class="form-control" required>
                        <option value="pendente">Pendente</option>
                        <option value="pago">Pago</option>
                        <option value="atrasado">Atrasado</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addPagamentoModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Pagamento -->
    <div id="editPagamentoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Editar Pagamento</h3>
                <button class="close-btn" onclick="closeModal('editPagamentoModal')">&times;</button>
            </div>
            <form id="editPagamentoForm">
                <input type="hidden" id="edit-pagamento-id">
                <div class="form-group">
                    <label class="form-label">Valor (R$)</label>
                    <input type="number" id="edit-pagamento-valor" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Data do Pagamento</label>
                    <input type="date" id="edit-data-pagamento" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="edit-pagamento-status" class="form-control" required>
                        <option value="pendente">Pendente</option>
                        <option value="pago">Pago</option>
                        <option value="atrasado">Atrasado</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editPagamentoModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Adicionar Observa√ß√£o -->
    <div id="addObservacaoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚ûï Nova Observa√ß√£o</h3>
                <button class="close-btn" onclick="closeModal('addObservacaoModal')">&times;</button>
            </div>
            <form id="addObservacaoForm">
                <div class="form-group">
                    <label class="form-label">Casa</label>
                    <select id="add-obs-casa-id" class="form-control" required>
                        <option value="">Selecione uma casa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea id="add-obs-descricao" class="form-control" rows="4" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" id="add-obs-data" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="add-obs-status" class="form-control" required>
                            <option value="pendente">Pendente</option>
                            <option value="em_andamento">Em Andamento</option>
                            <option value="resolvida">Resolvida</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addObservacaoModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Observa√ß√£o -->
    <div id="editObservacaoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Editar Observa√ß√£o</h3>
                <button class="close-btn" onclick="closeModal('editObservacaoModal')">&times;</button>
            </div>
            <form id="editObservacaoForm">
                <input type="hidden" id="edit-obs-id">
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea id="edit-obs-descricao" class="form-control" rows="4" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" id="edit-obs-data" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="edit-obs-status" class="form-control" required>
                            <option value="pendente">Pendente</option>
                            <option value="em_andamento">Em Andamento</option>
                            <option value="resolvida">Resolvida</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editObservacaoModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Upload Comprovante -->
    <div id="uploadComprovanteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìé Upload de Comprovante</h3>
                <button class="close-btn" onclick="closeModal('uploadComprovanteModal')">&times;</button>
            </div>
            <form id="uploadComprovanteForm" enctype="multipart/form-data">
                <input type="hidden" id="upload-casa-id">
                <input type="hidden" id="upload-mes">
                <input type="hidden" id="upload-ano">
                
                <div class="form-group">
                    <label class="form-label">Arquivo do Comprovante</label>
                    <div class="upload-area" onclick="document.getElementById('comprovante-file').click()">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">
                            Clique aqui ou arraste o arquivo<br>
                            <small>Formatos aceitos: JPG, PNG, PDF (m√°x. 5MB)</small>
                        </div>
                    </div>
                    <input type="file" id="comprovante-file" name="comprovante" class="file-input" 
                           accept=".jpg,.jpeg,.png,.pdf" required>
                </div>
                
                <div id="file-preview" style="display: none; margin: 15px 0;">
                    <p><strong>Arquivo selecionado:</strong> <span id="file-name"></span></p>
                    <p><strong>Tamanho:</strong> <span id="file-size"></span></p>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('uploadComprovanteModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üì§ Enviar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Indicador de status de conex√£o -->
    <div id="connection-status" class="connection-status online">üü¢ Online</div>

    <script>
        // Configura√ß√£o global da aplica√ß√£o
        const currentPath = window.location.pathname.replace('/index.php', '').replace(/\/$/, '');
        
        window.APP_CONFIG = {
            apiBase: currentPath + '/api/',
            uploadBase: currentPath + '/upload_comprovante.php',
            viewBase: currentPath + '/view_comprovante.php',
            loginApi: currentPath + '/login_api.php'
        };

        // Estado global da aplica√ß√£o
        let appState = {
            casas: [],
            pagamentos: [],
            observacoes: [],
            relatorios: {},
            currentTab: 'casas',
            loading: false
        };

        // Inicializa√ß√£o da aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                // Verificar se usu√°rio est√° logado
                const loginCheck = await checkLoginStatus();
                if (!loginCheck.logged_in) {
                    window.location.href = 'login.php';
                    return;
                }

                // Configurar informa√ß√µes do usu√°rio
                document.getElementById('user-name').textContent = loginCheck.user.nome;

                // Carregar dados iniciais
                await loadInitialData();

                // Configurar event listeners
                setupEventListeners();

                // Configurar monitor de conex√£o
                setupConnectionMonitor();

                // Mostrar sistema
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('main-system').style.display = 'block';

                console.log('Sistema inicializado com sucesso');
                
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
                showAlert('Erro ao carregar o sistema: ' + error.message, 'danger');
            }
        }

        // Verificar status de login
        async function checkLoginStatus() {
            try {
                const response = await fetch(window.APP_CONFIG.loginApi, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'check' })
                });
                
                return await response.json();
            } catch (error) {
                throw new Error('Erro ao verificar login');
            }
        }

        // Carregar dados iniciais
        async function loadInitialData() {
            try {
                setLoading(true);
                
                // Carregar todos os dados em paralelo
                const [casasResponse, pagamentosResponse, observacoesResponse] = await Promise.all([
                    apiRequest('casas'),
                    apiRequest('pagamentos'),
                    apiRequest('observacoes')
                ]);

                appState.casas = casasResponse.data || [];
                appState.pagamentos = pagamentosResponse.data || [];
                appState.observacoes = observacoesResponse.data || [];

                // Atualizar interface
                updateCasasView();
                updatePagamentosView();
                updateObservacoesView();
                updateRelatoriosView();
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showAlert('Erro ao carregar dados: ' + error.message, 'danger');
            } finally {
                setLoading(false);
            }
        }

        // Fun√ß√£o gen√©rica para requisi√ß√µes √† API
        async function apiRequest(endpoint, options = {}) {
            const url = window.APP_CONFIG.apiBase + endpoint;
            
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    ...options.headers
                },
                ...options
            };

            try {
                const response = await fetch(url, config);
                
                if (response.status === 401) {
                    window.location.href = 'login.php';
                    return null;
                }

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }

                return data;
            } catch (error) {
                console.error('Erro na API:', error);
                throw error;
            }
        }

        // Navega√ß√£o entre abas
        function showTab(tabName) {
            // Remover classe active de todas as abas
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Ativar aba selecionada
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
            
            appState.currentTab = tabName;
            
            // Carregar dados espec√≠ficos da aba se necess√°rio
            if (tabName === 'relatorios') {
                updateRelatoriosView();
            }
        }

        // Atualizar visualiza√ß√£o das casas
        function updateCasasView() {
            const container = document.getElementById('casas-container');
            const ocupadas = appState.casas.filter(casa => casa.morador).length;
            const vazias = appState.casas.length - ocupadas;
            const taxaOcupacao = appState.casas.length > 0 ? Math.round((ocupadas / appState.casas.length) * 100) : 0;

            // Atualizar estat√≠sticas
            document.getElementById('total-casas').textContent = appState.casas.length;
            document.getElementById('casas-ocupadas').textContent = ocupadas;
            document.getElementById('casas-vazias').textContent = vazias;
            document.getElementById('taxa-ocupacao').textContent = taxaOcupacao + '%';

            // Gerar HTML das casas
            container.innerHTML = appState.casas.map(casa => `
                <div class="casa-card ${casa.morador ? 'casa-ocupada' : 'casa-vazia'}">
                    <div class="casa-header">
                        <div class="casa-numero">Casa ${casa.numero}</div>
                        <div class="casa-status ${casa.morador ? 'status-ocupada' : 'status-vazia'}">
                            ${casa.morador ? 'Ocupada' : 'Vazia'}
                        </div>
                    </div>
                    <div class="casa-info">
                        <p><strong>Morador:</strong> ${casa.morador || 'Nenhum'}</p>
                        <p><strong>Telefone:</strong> ${casa.telefone || 'N/A'}</p>
                        <p><strong>Valor Mensal:</strong> ${casa.valor_mensal ? 'R$ ' + parseFloat(casa.valor_mensal).toFixed(2) : 'N/A'}</p>
                        ${casa.contrato_inicio ? `<p><strong>Contrato:</strong> ${formatDate(casa.contrato_inicio)} a ${formatDate(casa.contrato_fim)}</p>` : ''}
                    </div>
                    <div class="casa-actions">
                        <button class="btn btn-primary btn-sm" onclick="editCasa(${casa.id})">‚úèÔ∏è Editar</button>
                        ${casa.morador ? `<button class="btn btn-danger btn-sm" onclick="removeMorador(${casa.id})">üóëÔ∏è Remover</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Atualizar visualiza√ß√£o dos pagamentos
        function updatePagamentosView() {
            const container = document.getElementById('pagamentos-container');
            
            // Aplicar filtros
            let filteredPagamentos = [...appState.pagamentos];
            
            const filtroMes = document.getElementById('filtro-mes')?.value;
            const filtroAno = document.getElementById('filtro-ano')?.value;
            
            if (filtroMes) {
                filteredPagamentos = filteredPagamentos.filter(p => p.mes == filtroMes);
            }
            
            if (filtroAno) {
                filteredPagamentos = filteredPagamentos.filter(p => p.ano == filtroAno);
            }

            if (filteredPagamentos.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        üìã Nenhum pagamento encontrado para os filtros selecionados.
                    </div>
                `;
                return;
            }

            // Gerar tabela de pagamentos
            container.innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Casa</th>
                            <th>Morador</th>
                            <th>Per√≠odo</th>
                            <th>Valor</th>
                            <th>Data Pagamento</th>
                            <th>Status</th>
                            <th>Comprovante</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredPagamentos.map(pagamento => `
                            <tr class="pagamento-${pagamento.status}">
                                <td>Casa ${pagamento.numero}</td>
                                <td>${pagamento.morador || 'N/A'}</td>
                                <td>${String(pagamento.mes).padStart(2, '0')}/${pagamento.ano}</td>
                                <td>R$ ${parseFloat(pagamento.valor).toFixed(2)}</td>
                                <td>${pagamento.data_pagamento ? formatDate(pagamento.data_pagamento) : 'N/A'}</td>
                                <td>
                                    <span class="casa-status status-${pagamento.status}">
                                        ${getStatusLabel(pagamento.status)}
                                    </span>
                                </td>
                                <td>
                                    ${pagamento.comprovante ? 
                                        `<button class="btn btn-secondary btn-sm" onclick="viewComprovante('${pagamento.comprovante}')">üëÅÔ∏è Ver</button>` : 
                                        `<button class="btn btn-warning btn-sm" onclick="uploadComprovante(${pagamento.casa_id}, ${pagamento.mes}, ${pagamento.ano})">üìé Upload</button>`
                                    }
                                </td>
                                <td>
                                    <button class="btn btn-primary btn-sm" onclick="editPagamento(${pagamento.id})">‚úèÔ∏è</button>
                                    <button class="btn btn-danger btn-sm" onclick="deletePagamento(${pagamento.id})">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Atualizar visualiza√ß√£o das observa√ß√µes
        function updateObservacoesView() {
            const container = document.getElementById('observacoes-container');
            
            // Aplicar filtros
            let filteredObservacoes = [...appState.observacoes];
            
            const filtroStatus = document.getElementById('filtro-status-obs')?.value;
            if (filtroStatus) {
                filteredObservacoes = filteredObservacoes.filter(o => o.status === filtroStatus);
            }

            if (filteredObservacoes.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        üìã Nenhuma observa√ß√£o encontrada para os filtros selecionados.
                    </div>
                `;
                return;
            }

            // Gerar cards de observa√ß√µes
            container.innerHTML = `
                <div class="casas-grid">
                    ${filteredObservacoes.map(obs => `
                        <div class="casa-card observacao-${obs.status}">
                            <div class="casa-header">
                                <div class="casa-numero">Casa ${obs.numero}</div>
                                <div class="casa-status status-${obs.status}">
                                    ${getStatusObservacaoLabel(obs.status)}
                                </div>
                            </div>
                            <div class="casa-info">
                                <p><strong>Morador:</strong> ${obs.morador || 'N/A'}</p>
                                <p><strong>Data:</strong> ${formatDate(obs.data)}</p>
                                <p><strong>Descri√ß√£o:</strong> ${obs.descricao}</p>
                            </div>
                            <div class="casa-actions">
                                <button class="btn btn-primary btn-sm" onclick="editObservacao(${obs.id})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteObservacao(${obs.id})">üóëÔ∏è Excluir</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Atualizar visualiza√ß√£o dos relat√≥rios
        async function updateRelatoriosView() {
            try {
                const relatorio = await apiRequest('relatorios?tipo=geral');
                const container = document.getElementById('relatorios-container');
                
                if (relatorio && relatorio.data) {
                    const data = relatorio.data;
                    
                    // Atualizar estat√≠sticas
                    document.getElementById('receita-mes').textContent = 'R$ ' + (data.pagamentos_mes_atual.receita_recebida || 0).toFixed(2);
                    document.getElementById('pagamentos-pendentes').textContent = data.pagamentos_mes_atual.pagamentos_pendentes || 0;
                    document.getElementById('observacoes-abertas').textContent = data.observacoes_pendentes || 0;
                    document.getElementById('taxa-recebimento').textContent = (data.taxa_recebimento || 0) + '%';
                    
                    // Mostrar relat√≥rio detalhado
                    container.innerHTML = `
                        <div class="alert alert-info">
                            <h4>üìä Resumo Geral do Condom√≠nio</h4>
                            <p><strong>Taxa de Ocupa√ß√£o:</strong> ${data.taxa_ocupacao}%</p>
                            <p><strong>Receita Esperada (m√™s atual):</strong> R$ ${(data.pagamentos_mes_atual.receita_esperada || 0).toFixed(2)}</p>
                            <p><strong>Receita Recebida (m√™s atual):</strong> R$ ${(data.pagamentos_mes_atual.receita_recebida || 0).toFixed(2)}</p>
                            <p><strong>Taxa de Recebimento:</strong> ${data.taxa_recebimento}%</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar relat√≥rios:', error);
            }
        }

        // Fun√ß√£o para editar casa
        function editCasa(id) {
            const casa = appState.casas.find(c => c.id === id);
            if (!casa) return;

            document.getElementById('edit-casa-id').value = casa.id;
            document.getElementById('edit-morador').value = casa.morador || '';
            document.getElementById('edit-telefone').value = casa.telefone || '';
            document.getElementById('edit-contrato-inicio').value = casa.contrato_inicio || '';
            document.getElementById('edit-contrato-fim').value = casa.contrato_fim || '';
            document.getElementById('edit-valor-mensal').value = casa.valor_mensal || '';

            showModal('editCasaModal');
        }

        // Fun√ß√£o para remover morador
        async function removeMorador(id) {
            if (!confirm('Tem certeza que deseja remover este morador?')) return;

            try {
                await apiRequest(`casas/${id}`, { method: 'DELETE' });
                showAlert('Morador removido com sucesso!', 'success');
                await loadInitialData();
            } catch (error) {
                showAlert('Erro ao remover morador: ' + error.message, 'danger');
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Formul√°rio de editar casa
            document.getElementById('editCasaForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    id: document.getElementById('edit-casa-id').value,
                    morador: document.getElementById('edit-morador').value,
                    telefone: document.getElementById('edit-telefone').value,
                    contrato_inicio: document.getElementById('edit-contrato-inicio').value,
                    contrato_fim: document.getElementById('edit-contrato-fim').value,
                    valor_mensal: parseFloat(document.getElementById('edit-valor-mensal').value)
                };

                try {
                    await apiRequest('casas', {
                        method: 'POST',
                        body: JSON.stringify(formData)
                    });
                    
                    showAlert('Casa atualizada com sucesso!', 'success');
                    closeModal('editCasaModal');
                    await loadInitialData();
                } catch (error) {
                    showAlert('Erro ao atualizar casa: ' + error.message, 'danger');
                }
            });

            // Filtros de pagamentos
            document.getElementById('filtro-mes')?.addEventListener('change', updatePagamentosView);
            document.getElementById('filtro-ano')?.addEventListener('change', updatePagamentosView);
            document.getElementById('filtro-status-obs')?.addEventListener('change', updateObservacoesView);

            // Upload de comprovante
            document.getElementById('comprovante-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('file-name').textContent = file.name;
                    document.getElementById('file-size').textContent = formatFileSize(file.size);
                    document.getElementById('file-preview').style.display = 'block';
                }
            });
        }

        // Fun√ß√µes auxiliares
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getStatusLabel(status) {
            const labels = {
                'pendente': 'Pendente',
                'pago': 'Pago',
                'atrasado': 'Atrasado'
            };
            return labels[status] || status;
        }

        function getStatusObservacaoLabel(status) {
            const labels = {
                'pendente': 'Pendente',
                'em_andamento': 'Em Andamento',
                'resolvida': 'Resolvida'
            };
            return labels[status] || status;
        }

        // Fun√ß√µes de modal
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Fechar modais clicando fora
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // Fun√ß√£o para mostrar alertas
        function showAlert(message, type = 'info') {
            const alertsContainer = document.getElementById('alerts-container') || createAlertsContainer();
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                ${message}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 18px; cursor: pointer;">&times;</button>
            `;
            
            alertsContainer.appendChild(alertDiv);
            
            // Auto remover ap√≥s 5 segundos
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function createAlertsContainer() {
            const container = document.createElement('div');
            container.id = 'alerts-container';
            container.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 10000; max-width: 400px;';
            document.body.appendChild(container);
            return container;
        }

        // Fun√ß√£o para definir estado de loading
        function setLoading(loading) {
            appState.loading = loading;
            const loadingElements = document.querySelectorAll('.loading-target');
            
            loadingElements.forEach(el => {
                if (loading) {
                    el.classList.add('loading');
                } else {
                    el.classList.remove('loading');
                }
            });
        }

        // Fun√ß√£o de logout
        async function logout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                try {
                    await fetch(window.APP_CONFIG.loginApi, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'logout' })
                    });
                } catch (error) {
                    console.error('Erro no logout:', error);
                }
                
                window.location.reload();
            }
        }

        // Fun√ß√£o para mostrar modal de adicionar pagamento
        function showAddPagamentoModal() {
            // Carregar casas ocupadas no select
            const select = document.getElementById('add-casa-id');
            select.innerHTML = '<option value="">Selecione uma casa</option>';
            
            appState.casas.filter(casa => casa.morador).forEach(casa => {
                select.innerHTML += `<option value="${casa.id}">Casa ${casa.numero} - ${casa.morador}</option>`;
            });
            
            // Definir m√™s e ano atuais
            const now = new Date();
            document.getElementById('add-mes').value = now.getMonth() + 1;
            document.getElementById('add-ano').value = now.getFullYear();
            
            showModal('addPagamentoModal');
        }

        // Fun√ß√£o para adicionar pagamento
        document.getElementById('addPagamentoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                casa_id: parseInt(document.getElementById('add-casa-id').value),
                mes: parseInt(document.getElementById('add-mes').value),
                ano: parseInt(document.getElementById('add-ano').value),
                valor: parseFloat(document.getElementById('add-valor').value),
                data_pagamento: document.getElementById('add-data-pagamento').value || null,
                status: document.getElementById('add-status').value
            };

            try {
                await apiRequest('pagamentos', {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });
                
                showAlert('Pagamento criado com sucesso!', 'success');
                closeModal('addPagamentoModal');
                this.reset();
                await loadInitialData();
            } catch (error) {
                showAlert('Erro ao criar pagamento: ' + error.message, 'danger');
            }
        });

        // Fun√ß√£o para editar pagamento
        function editPagamento(id) {
            const pagamento = appState.pagamentos.find(p => p.id === id);
            if (!pagamento) return;

            document.getElementById('edit-pagamento-id').value = pagamento.id;
            document.getElementById('edit-pagamento-valor').value = pagamento.valor;
            document.getElementById('edit-data-pagamento').value = pagamento.data_pagamento || '';
            document.getElementById('edit-pagamento-status').value = pagamento.status;

            showModal('editPagamentoModal');
        }

        // Formul√°rio de editar pagamento
        document.getElementById('editPagamentoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('edit-pagamento-id').value;
            const formData = {
                valor: parseFloat(document.getElementById('edit-pagamento-valor').value),
                data_pagamento: document.getElementById('edit-data-pagamento').value || null,
                status: document.getElementById('edit-pagamento-status').value
            };

            try {
                await apiRequest(`pagamentos/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(formData)
                });
                
                showAlert('Pagamento atualizado com sucesso!', 'success');
                closeModal('editPagamentoModal');
                await loadInitialData();
            } catch (error) {
                showAlert('Erro ao atualizar pagamento: ' + error.message, 'danger');
            }
        });

        // Fun√ß√£o para excluir pagamento
        async function deletePagamento(id) {
            if (!confirm('Tem certeza que deseja excluir este pagamento?')) return;

            try {
                await apiRequest(`pagamentos/${id}`, { method: 'DELETE' });
                showAlert('Pagamento exclu√≠do com sucesso!', 'success');
                await loadInitialData();
            } catch (error) {
                showAlert('Erro ao excluir pagamento: ' + error.message, 'danger');
            }
        }

        // Fun√ß√£o para mostrar modal de adicionar observa√ß√£o
        function showAddObservacaoModal() {
            // Carregar todas as casas no select
            const select = document.getElementById('add-obs-casa-id');
            select.innerHTML = '<option value="">Selecione uma casa</option>';
            
            appState.casas.forEach(casa => {
                const label = casa.morador ? `Casa ${casa.numero} - ${casa.morador}` : `Casa ${casa.numero} (vazia)`;
                select.innerHTML += `<option value="${casa.id}">${label}</option>`;
            });
            
            // Definir data atual
            document.getElementById('add-obs-data').value = new Date().toISOString().split('T')[0];
            
            showModal('addObservacaoModal');
        }

        // Formul√°rio de adicionar observa√ß√£o
        document.getElementById('addObservacaoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                casa_id: parseInt(document.getElementById('add-obs-casa-id').value),
                descricao: document.getElementById('add-obs-descricao').value,
                data: document.getElementById('add-obs-data').value,
                status: document.getElementById('add-obs-status').value
            };

            try {
                await apiRequest('observacoes', {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });
                
                showAlert('Observa√ß√£o criada com sucesso!', 'success');
                closeModal('addObservacaoModal');
                this.reset();
                await loadInitialData();
            } catch (error) {
                showAlert('Erro ao criar observa√ß√£o: ' + error.message, 'danger');
            }
        });

        // Fun√ß√£o para editar observa√ß√£o
        function editObservacao(id) {
            const observacao = appState.observacoes.find(o => o.id === id);
            if (!observacao) return;

            document.getElementById('edit-obs-id').value = observacao.id;
            document.getElementById('edit-obs-descricao').value = observacao.descricao;
            document.getElementById('edit-obs-data').value = observacao.data;
            document.getElementById('edit-obs-status').value = observacao.status;

            showModal('editObservacaoModal');
        }

        // Formul√°rio de editar observa√ß√£o
        document.getElementById('editObservacaoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('edit-obs-id').value;
            const formData = {
                descricao: document.getElementById('edit-obs-descricao').value,
                data: document.getElementById('edit-obs-data').value,
                status: document.getElementById('edit-obs-status').value
            };

            try {
                await apiRequest(`observacoes/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(formData)
                });
                
                showAlert('Observa√ß√£o atualizada com sucesso!', 'success');
                closeModal('editObservacaoModal');
                await loadInitialData();
            } catch (error) {
                showAlert('Erro ao atualizar observa√ß√£o: ' + error.message, 'danger');
            }
        });

        // Fun√ß√£o para excluir observa√ß√£o
        async function deleteObservacao(id) {
            if (!confirm('Tem certeza que deseja excluir esta observa√ß√£o?')) return;

            try {
                await apiRequest(`observacoes/${id}`, { method: 'DELETE' });
                showAlert('Observa√ß√£o exclu√≠da com sucesso!', 'success');
                await loadInitialData();
            } catch (error) {
                showAlert('Erro ao excluir observa√ß√£o: ' + error.message, 'danger');
            }
        }

        // Fun√ß√£o para upload de comprovante
        function uploadComprovante(casaId, mes, ano) {
            document.getElementById('upload-casa-id').value = casaId;
            document.getElementById('upload-mes').value = mes;
            document.getElementById('upload-ano').value = ano;
            
            // Limpar formul√°rio
            document.getElementById('uploadComprovanteForm').reset();
            document.getElementById('file-preview').style.display = 'none';
            
            showModal('uploadComprovanteModal');
        }

        // Formul√°rio de upload de comprovante
        document.getElementById('uploadComprovanteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('comprovante', document.getElementById('comprovante-file').files[0]);
            formData.append('casa_id', document.getElementById('upload-casa-id').value);
            formData.append('mes', document.getElementById('upload-mes').value);
            formData.append('ano', document.getElementById('upload-ano').value);

            try {
                const response = await fetch(window.APP_CONFIG.uploadBase, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('Comprovante enviado com sucesso!', 'success');
                    closeModal('uploadComprovanteModal');
                    await loadInitialData();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                showAlert('Erro ao enviar comprovante: ' + error.message, 'danger');
            }
        });

        // Fun√ß√£o para visualizar comprovante
        function viewComprovante(filename) {
            const url = `${window.APP_CONFIG.viewBase}?file=${encodeURIComponent(filename)}`;
            window.open(url, '_blank');
        }

        // Monitor de conex√£o
        function setupConnectionMonitor() {
            const statusEl = document.getElementById('connection-status');
            
            function updateStatus() {
                if (navigator.onLine) {
                    statusEl.textContent = 'üü¢ Online';
                    statusEl.className = 'connection-status online';
                } else {
                    statusEl.textContent = 'üî¥ Offline';
                    statusEl.className = 'connection-status offline';
                }
            }

            window.addEventListener('online', updateStatus);
            window.addEventListener('offline', updateStatus);
            updateStatus();
        }

        // Atualizar dados periodicamente
        setInterval(async function() {
            if (!appState.loading && navigator.onLine) {
                try {
                    await loadInitialData();
                } catch (error) {
                    console.error('Erro na atualiza√ß√£o autom√°tica:', error);
                }
            }
        }, 5 * 60 * 1000); // A cada 5 minutos

        // Atalhos de teclado
        document.addEventListener('keydown', function(e) {
            // ESC para fechar modais
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.show').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
            
            // Ctrl+R para recarregar dados
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                loadInitialData();
            }
        });

        // Configurar drag and drop para upload
        const uploadArea = document.querySelector('.upload-area');
        if (uploadArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                uploadArea.classList.add('dragover');
            }

            function unhighlight(e) {
                uploadArea.classList.remove('dragover');
            }

            uploadArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    document.getElementById('comprovante-file').files = files;
                    const file = files[0];
                    document.getElementById('file-name').textContent = file.name;
                    document.getElementById('file-size').textContent = formatFileSize(file.size);
                    document.getElementById('file-preview').style.display = 'block';
                }
            }
        }

        // Valida√ß√£o de formul√°rios em tempo real
        document.querySelectorAll('.form-control').forEach(input => {
            input.addEventListener('blur', function() {
                validateField(this);
            });
        });

        function validateField(field) {
            field.classList.remove('is-invalid', 'is-valid');
            
            if (field.hasAttribute('required') && !field.value.trim()) {
                field.classList.add('is-invalid');
                return false;
            }
            
            if (field.type === 'email' && field.value && !isValidEmail(field.value)) {
                field.classList.add('is-invalid');
                return false;
            }
            
            if (field.type === 'number' && field.value && isNaN(field.value)) {
                field.classList.add('is-invalid');
                return false;
            }
            
            field.classList.add('is-valid');
            return true;
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        // Auto-salvar rascunhos (localStorage para formul√°rios)
        const autoSaveFields = ['edit-morador', 'edit-telefone', 'add-obs-descricao'];
        
        autoSaveFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                // Carregar valor salvo
                const savedValue = localStorage.getItem(`draft_${fieldId}`);
                if (savedValue) {
                    field.value = savedValue;
                }
                
                // Salvar ao digitar
                field.addEventListener('input', function() {
                    localStorage.setItem(`draft_${fieldId}`, this.value);
                });
                
                // Limpar ao enviar formul√°rio
                const form = field.closest('form');
                if (form) {
                    form.addEventListener('submit', function() {
                        localStorage.removeItem(`draft_${fieldId}`);
                    });
                }
            }
        });

        // Confirmar sa√≠da se houver dados n√£o salvos
        let hasUnsavedChanges = false;
        
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('change', function() {
                hasUnsavedChanges = true;
            });
            
            form.addEventListener('submit', function() {
                hasUnsavedChanges = false;
            });
        });

        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // Logs de debug (apenas em desenvolvimento)
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('üè° Sistema Condom√≠nio Vit√≥ria R√©gia');
            console.log('üîß Modo desenvolvimento ativo');
            console.log('üìä Estado inicial:', appState);
            
            // Fun√ß√£o global para debug
            window.debugApp = function() {
                console.log('Estado atual:', appState);
                console.log('Casas:', appState.casas.length);
                console.log('Pagamentos:', appState.pagamentos.length);
                console.log('Observa√ß√µes:', appState.observacoes.length);
            };
        }

        console.log('‚úÖ Sistema Condom√≠nio Vit√≥ria R√©gia carregado com sucesso!');
    </script>
</body>
</html>